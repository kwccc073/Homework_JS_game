<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>翻牌作業</title>
    <!-- 引入bootstrap -->
    <link rel="stylesheet" href=https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.css />
    <style>
        .hidden {
            visibility: hidden;
        }

        /* 排列成4*5 .Arrangement*/
        #game {
            width: 1000px;
            height: 700px;
            background: darkcyan;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }


        .card {
            width: 50px;
            height: 90px;
            position: relative;
            margin: 10px;
            /* 設定子元素在3D空間內 */
            transform-style: preserve-3d;
            /* 使他們並排 */
            float: left;
            transition: transform 1s;
            /* top: 0px;
            left: 0px; */

        }

        .card-front {
            width: 100%;
            height: 100%;
            background: yellow;
            position: absolute;
            /* 把背面隱藏 */
            backface-visibility: hidden;
            text-align: center;
            /* 垂直置中 */
            font-size: 35px;
        }

        .card-back {
            width: 100%;
            height: 100%;
            background-image: url(./img/blue_back.jpg);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: absolute;
            backface-visibility: hidden;
            /* 預設180deg，讓他翻到背面 */
            transform: rotateY(180deg);
        }

        .card-close {
            transform: rotateY(180deg);
        }
    </style>
</head>

<body>
    <!-- 待新增功能：
        發牌動畫（感覺麻煩，先不要加）
        -->

    <div class="game-title">日本のゲーム</div>
    <!-- 選擇要玩的遊戲 -->
    <form>
        <select id="choice-game">
            <option value="Hiragana">平假名</option>
            <option value="Katakana">片假名</option>
            <!-- 有時間的話再加單字題 -->
        </select>
        <input type="submit" value="開始遊戲" class="game_btn">
    </form>

    <!-- 此行應該不需要了<button class="game_btn">遊戲開始</button> -->
    <p id="time" class="hidden">經過時間：0秒</p>
    <p id="bingo" class="hidden">已答對0題，剩餘10題</p>
    <!-- 進度條 -->
    <div class="progress hidden" style="width: 80%;">
        <div class="progress-bar" style="width: 0%;"></div>
    </div>
    <!-- 進度條可參考bootstrap 0607的檔案7 https://bootstrap5.hexschool.com/docs/5.1/components/progress/ -->

    <!-- 遊戲區域 -->
    <div id="game"></div>

    <!-- 引入JQ -->
    <script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js></script>
    <!-- 引入Vue -->
    <script src=https://cdnjs.cloudflare.com/ajax/libs/vue/3.4.27/vue.global.min.js></script>
    <!-- 引入bootsraps -->
    <script src=https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.js></script>

    <script>
        // 牌面花色
        // 平假名
        const Hiragana = ['あ', 'い', 'う', 'え', 'お', 'か', 'き', 'く', 'け', 'こ', 'さ', 'し', 'す', 'せ', 'そ', 'た', 'ち', 'つ', 'て', 'と', 'な', 'に', 'ぬ', 'ね', 'の', 'は', 'ひ', 'ふ', 'へ', 'ほ', 'ま', 'み', 'む', 'め', 'も', 'や', 'ゆ', 'よ', 'ら', 'り', 'る', 'れ', 'ろ', 'わ', 'を', 'ん']
        // 片假名
        const Katakana = ['ア', 'イ', 'ウ', 'エ', 'オ', 'カ', 'キ', 'ク', 'ケ', 'コ', 'サ', 'シ', 'ス', 'セ', 'ソ', 'タ', 'チ', 'ツ', 'テ', 'ト', 'ナ', '二', 'ヌ', 'ネ', 'ノ', 'ハ', 'ヒ', 'フ', 'ヘ', 'ホ', 'マ', 'ミ', 'ム', 'メ', 'モ', 'ヤ', 'ユ', 'ヨ', 'ラ', 'リ', 'ル', 'レ', 'ロ', 'ワ', 'ン', 'ヲ']
        // 拼音
        const Pinyin = ['a', 'i', 'u', 'e', 'o', 'ka', 'ki', 'ku', 'ke', 'ko', 'sa', 'shi', 'su', 'se', 'so', 'ta', 'chi', 'tsu', 'te', 'to', 'na', 'ni', 'nu', 'ne', 'no', 'ha', 'hi', 'fu', 'he', 'ho', 'ma', 'mi', 'mu', 'me', 'mo', 'ya', 'yu', 'yo', 'ra', 'ri', 'ru', 're', 'ro', 'wa', 'wo', 'n']



        // 按下開始按鈕，產生隨機排列的卡片
        $('.game_btn').click(function () {
            // 按鈕停用設定
            $(this).attr('disabled', true)

            // 顯示剩餘時間、已答對題數、進度條
            $('.hidden').removeClass('hidden')


            // 產生二十張卡片
            for (let i = 0; i < 20; i++) {
                $('#game').append(`
            <div class="card card-close">
                <div class="card-front"></div>
                <div class="card-back"></div>
            </div>
            `)
            }

            // 隨機分配花色
            // random陣列用於避免取道重複的花色
            let random = []
            // 總共取出十組花色 (20/2=10)
            for (let i = 0; i < 10; i++) {
                // 隨機取一個數字做為花色陣列之index
                let randomNumber = Math.round(Math.random() * 45)

                // 如果這個數字還沒出現過，則進行下方步驟
                if (!random.includes(randomNumber)) {
                    random.push(randomNumber)
                    // 前面十張是平片假名(index為 0-9)
                    // 選擇平假名關卡
                    if ($("#choice-game").val() === "Hiragana") {
                        $('.card-front').eq(i).text(Hiragana[randomNumber])
                    }
                    // 選擇片假名關卡
                    else if ($("#choice-game").val() === "Katakana") {
                        $('.card-front').eq(i).text(Katakana[randomNumber])
                    }
                    $('.card-front').eq(i).attr('data-number', randomNumber)
                    //後面十張是羅馬拼音(index為 10-19)
                    $('.card-front').eq(i + 10).text(Pinyin[randomNumber])
                    $('.card-front').eq(i + 10).attr('data-number', randomNumber)
                } else {
                    i--
                }
            }

            // 打亂牌
            // for (let i = 0; i < 20; i++) {
            //     const randA = Math.round(Math.random() * 19)
            //     const randB = Math.round(Math.random() * 19)
            //     $('.card').eq(randA).insertAfter($('.card').eq(randB))
            // }

            // 發牌動畫（移動位置）
            // $('.card').attr('top', '100px')


            // 發完牌後X秒，先全部攤開
            // const OpenCloseCard = async () => {
            //     await setTimeout(function () {
            //         $('.card').removeClass('card-close')
            //     }, 1000)
            //     await setTimeout(function () {
            //         $('.card').addClass('card-close')
            //     }, 2000)
            // }

            // 一層包一層是讓一個計時器完成才進行下一個計時器
            setTimeout(function () {
                // 按下按鈕後一秒會將全部的牌打開
                $('.card').removeClass('card-close')
                // 再過兩秒會將牌關起來
                setTimeout(function () {
                    $('.card').addClass('card-close')
                    // 關起來一秒後會開始計時
                    setTimeout(() => {
                        alert('遊戲開始')
                        // 倒數計時
                        let time = 0
                        const timer = setInterval(() => {
                            time++
                            $('#time').text(`經過時間：${time}秒`)
                        }, 1000)


                        // 開始計時之後才開始進行翻牌的判斷

                        // 答對題數
                        let bingo = 0

                        // 這裡的.card已經出現，所以不需要用on
                        $('.card').click(function () {
                            // 翻牌動作
                            if (
                                // 打開的牌小於兩張
                                $('.card:not(.card-close)').length < 2 &&
                                // 這張牌目前關起來
                                $(this).hasClass('card-close') &&
                                // 這張牌尚未被配對
                                !$(this).hasClass('card-ok')
                            ) {
                                $(this).removeClass('card-close')
                            }

                            // 翻開兩張牌之後，要進行判斷
                            if ($('.card:not(.card-close)').length === 2) {
                                // 如果兩張都一樣就加上.card-ok並淡出
                                if ($('.card:not(.card-close) .card-front').eq(0).attr('data-number') ===
                                    $('.card:not(.card-close) .card-front').eq(1).attr('data-number')
                                ) {
                                    $('.card:not(.card-close)').addClass('card-ok')
                                    $('.card:not(.card-close)').fadeTo(1000, 0)
                                    bingo++
                                    console.log(bingo)
                                    $('.progress-bar').css('width', `${bingo * 10}%`)
                                    $('#bingo').text(`已答對${bingo}題，剩餘${10 - bingo}題`)
                                }
                                setTimeout(function () {
                                    // 把不對的牌蓋起來
                                    $('.card:not(.card-close)').addClass('card-close')
                                    // 當全部答對，結束計時並顯示alert
                                    if (
                                        // 正確值：($('.card-ok').length === $('.card').length)，下方=4是暫時測試用
                                        $('.card-ok').length === 4
                                    ) {
                                        clearInterval(timer)
                                        alert(`恭喜過關，總共花費${time}秒`)
                                        // 可加放煙火動畫
                                    }
                                }, 1000)
                            }
                        })
                    }, 1000);
                }, 2000)
            }, 1000)
        })





    </script>
</body>

</html>